<!doctype html>
<html lang="en">
    <head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content='text/html; charset=utf-8' http-equiv='content-type' />
<meta name="generator" content="Hugo 0.136.3">



<link href="http://mihael-tunik.github.io/css/styles.css" rel="stylesheet">
<title>MT mini-blog</title>
<meta name="description" content="Everybody knows about marching squares or cubes.
These methods are typically used for contour line/surface computation.
This problem is actually a particular case of more general zero set problem.
In marching squares function f acts from R2 → R and zero set problem consists of one equation.
Algorithm is fairly trivial in its nature: if there&rsquo;s a function sign change on the grid edge then we have a contour inside.
Can we generalize this approach?">
<meta name="author" content="">


<meta property="og:description" content="Everybody knows about marching squares or cubes.
These methods are typically used for contour line/surface computation.
This problem is actually a particular case of more general zero set problem.
In marching squares function f acts from R2 → R and zero set problem consists of one equation.
Algorithm is fairly trivial in its nature: if there&rsquo;s a function sign change on the grid edge then we have a contour inside.
Can we generalize this approach?" />







<meta name="twitter:description" content="Everybody knows about marching squares or cubes.
These methods are typically used for contour line/surface computation.
This problem is actually a particular case of more general zero set problem.
In marching squares function f acts from R2 → R and zero set problem consists of one equation.
Algorithm is fairly trivial in its nature: if there&rsquo;s a function sign change on the grid edge then we have a contour inside.
Can we generalize this approach?">


</head>
    <body>
        <div class="content">
            <nav class="blog-navigation">
  <div class="left">
      <div class="blog-logo">
        <a href='/' title="MT mini-blog">
          <img src="http://mihael-tunik.github.io/img/logo.svg" alt="MT mini-blog">
        </a>
      </div>
      <div class="blog-info">
          <div class="blog-title">
            <a href='/' title="MT mini-blog">
              <h1>MT mini-blog</h1>
            </a>
          </div>
          <div class="blog-description">
            <a href='/' title="MT mini-blog">
              <h2>Things around computer science</h2>
            </a>
          </div>
      </div>
  </div>
  <div class="right">
    <div class="blog-links">
      <ul class="links">
          <li class="item social"><a href='https://github.com/mihael-tunik' title="Github" target="_blank">Github</a></li>
      </ul>
    </div>
  </div>
</nav>
<div class="single">
    <article>
        <div class="article-meta">
    <ul class="article-info">
        <li class="time" style="">
            <time class="time">19 Jun 2024</time>
        </li>
        <li class="reading-time" style="">
            <span class="material-icons">timer</span>7 min read
        </li>
        <li class="words-count" style="">
            <span class="material-icons">article</span>1412 words
        </li>
    </ul>
    <ul class="article-tags" style="">
                <li>
                    <a href='/tags/algorithms'>#algorithms</a>
                </li>
                <li>
                    <a href='/tags/easy'>#easy</a>
                </li>
                <li>
                    <a href='/tags/cpp'>#cpp</a>
                </li>
    </ul>
</div>
        <div class="article-header">
            <h1 class="article-title">Integer labeling for zero set estimation</h1>          
            <h2 class="article-excerpt"></h2>  
        </div>
        <div class="article-content">
            <p>Everybody knows about marching squares or cubes.
These methods are typically used for contour line/surface computation.
This problem is actually a particular case of more general <strong>zero set problem</strong>.
In marching squares function f acts from R<sup>2</sup> → R and zero set problem consists of one equation.
Algorithm is fairly trivial in its nature: <em>if there&rsquo;s a function sign change on the grid edge then we have a contour inside</em>.
Can we generalize this approach?</p>
<p>What if f is a <em>vector-function</em> and acts, for example, R<sup>3</sup> → R<sup>2</sup>?
Surprisingly, there&rsquo;s nice family of algorithms to handle this, called <em>labeling</em> methods.</p>
<h2 id="zero-set-problem">Zero set problem</h2>
<p>First, let&rsquo;s define the problem:</p>
<blockquote>
<p>For vector-valued function f: R<sup>n</sup> → R<sup>m</sup> find x values f(x<sub>1</sub>, &hellip;, x<sub>n</sub>) = (0, &hellip;, 0).</p>
</blockquote>
<h2 id="labeling-methods">Labeling methods</h2>
<p>Now, let&rsquo;s return to the labeling. So it&rsquo;s <em>labeling algorithms</em> and that means that we have grid/space subdivision and for every vertice of it
we&rsquo;ll compute some <em>label values</em>. Then according to them we can find what grid elements/cells present the zero set of our function.
Important thing to say is that function f here is approximated by piecewise linear version of itself f<sub>PL</sub>, which is easy to define:
values on vertices will be the same and linearly interpolated inside the cell.
<img src="/images/f_pl_21.svg" alt="MS"> For brevity let&rsquo;s call R<sup>n</sup> → R<sup>m</sup> zero set problems by the tuple (n, m). There&rsquo;s at least two of labeling strategies known:
<strong>integer</strong> and <strong>vector labeling</strong>. We focus on the integer labeling, because it&rsquo;s less obvious and more elegant.</p>
<p>First, suppose we have simplicial space subdivision. Then, we should define the labeling rule for every vertice.
For example, according to Introduction to <em>Numerical Continuation Methods</em> by Eugene L. Allgower and Kurt Georg
appropriate labeling of simplex vertices can be defined as simple as <strong>number of initial coordinates of f which are positive</strong>.
Simplex is called <em>completely labeled</em> if set of its vertices contains every possible labeling.
Every simplicial subdivision under certain conditions on the labeling contain such simplex and this fact is connected with Sperner&rsquo;s Lemma (somehow).</p>
<p>Then the following statement is true:</p>
<blockquote>
<p>For function f : R<sup>n</sup> → R<sup>m</sup> and simplicial subdivision of R<sup>n</sup> define labeling L<sub>s</sub>(v) as number of positive initial coordinates of f,
then in subdivision <strong>completely labeled simplices and only them contain non-empty intersection with f<sub>PL</sub>(x) zero set</strong>.</p>
</blockquote>
<p>But why do we need exactly complete labeling in multidimensional case? For now, I didn&rsquo;t found corresponding theorem with proof in strict form.</p>
<p>However we can gain some intuition by hand-waving explanation and examples.
On the following picture, there&rsquo;s one example of completely labeled simplex for (3,2)-problem.
<img src="/images/completely_labeled_32.svg" alt="Example_32">
It has four vertices f1, f2, f3, f4 and labelings corresponding to underlying vector-function component signs ({+, -} means f<sub>1</sub> &gt; 0, f<sub>2</sub> &lt; 0).
Then it&rsquo;s easy to see that there exists a point (0, -) between f1 and f2 and (0, +) between f3 and f4 by linearity of f<sub>PL</sub> approximation.
So we have one zero point u of f_PL on the line between them.
Following the same logic another zero point v can be found. Solution of (3, 2)-problem for linear function f<sub>PL</sub> should be a line between u and v.</p>
<p>On this example it&rsquo;s getting obvious why it&rsquo;s not enough to use sign change condition (like in marching squares).
For example, {{+, -}, {-, +}}-edge with different signs for f coordinates will indeed contain zeros of f<sub>PL</sub> in every component,
but they will be achieved <strong>not</strong> simultaneously. So we can see, why <em>completeness of labeling</em> is more forcing and necessary condition.</p>
<p>Interesting notes:</p>
<ul>
<li>For (3,2)-problem zero set approximation is generally a polygonal chain. On every subdivision simplex which is completely labeled
there&rsquo;s a <em>door in</em> facet where this chain enters the simplex and <em>door out</em> facet, where it leaves it. Can such facets be found with only labelings given?
Actually, for every (n+1, n)-problem zero set approximation is a polygonal chain in R<sup>n+1</sup>.
Can the general rule be formulated for <em>door</em> simplices facets?</li>
</ul>
<h2 id="code">Code</h2>
<p>Three years ago in my <a href="https://github.com/mihael-tunik/PLClib">project</a> I implemented <em>integer labeling</em>.
More precisely, simplified version (3,2)-algorithm for rough estimation of zero sets.</p>
<p>Let&rsquo;s see what is going on in this code and where magic happens.
Here&rsquo;s full version (without extra prints) ~120 lines of code:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#include</span> <span style="color:#8f5902;font-style:italic">&lt;stdio.h&gt;</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#include</span> <span style="color:#8f5902;font-style:italic">&lt;iostream&gt;</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#include</span> <span style="color:#8f5902;font-style:italic">&lt;stdlib.h&gt;</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#include</span> <span style="color:#8f5902;font-style:italic">&lt;vector&gt;</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#define COMPLETELY_LABELED(x) ((x) == 0x7)
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">using</span> <span style="color:#204a87;font-weight:bold">namespace</span> <span style="color:#000">std</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">typedef</span> <span style="color:#204a87;font-weight:bold">struct</span> 
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>   <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">Nxy</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">Nz</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>   <span style="color:#204a87;font-weight:bold">double</span> <span style="color:#000">x_min</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#204a87;font-weight:bold">double</span> <span style="color:#000">x_max</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>   <span style="color:#204a87;font-weight:bold">double</span> <span style="color:#000">y_min</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#204a87;font-weight:bold">double</span> <span style="color:#000">y_max</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>   <span style="color:#204a87;font-weight:bold">double</span> <span style="color:#000">z_min</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#204a87;font-weight:bold">double</span> <span style="color:#000">z_max</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span><span style="color:#000">grid_t</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">typedef</span> <span style="color:#204a87;font-weight:bold">struct</span> 
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">double</span> <span style="color:#000">data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">];</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span><span style="color:#000">d_pair</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">label_fast</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">d_pair</span> <span style="color:#000">f_val</span><span style="color:#000;font-weight:bold">){</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">map</span><span style="color:#000;font-weight:bold">[]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">r</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">((</span><span style="color:#000">f_val</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">&gt;=</span> <span style="color:#0000cf;font-weight:bold">0.0</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">f_val</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">&gt;=</span> <span style="color:#0000cf;font-weight:bold">0.0</span><span style="color:#000;font-weight:bold">);</span>        
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">map</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">r</span><span style="color:#000;font-weight:bold">];</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">double</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">f_wrapped_vec</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">N</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">double</span> <span style="color:#000">z</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">ptr</span><span style="color:#000;font-weight:bold">)(</span><span style="color:#204a87;font-weight:bold">int</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">double</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">double</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#204a87;font-weight:bold">double</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">slice_data_ptr</span><span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">ptr</span><span style="color:#000;font-weight:bold">)(</span><span style="color:#000">N</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">z</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">slice_data_ptr</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">slice_data_ptr</span><span style="color:#000;font-weight:bold">;</span>   
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">label_fast_vec</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">double</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">slice_data</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">char</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">cache</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">size</span><span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">NN</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">size</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">size</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">l</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">l</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">NN</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000">l</span><span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">d_pair</span> <span style="color:#000">f_val</span><span style="color:#000;font-weight:bold">;</span>       
</span></span><span style="display:flex;"><span>        <span style="color:#000">f_val</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">slice_data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">l</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">f_val</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">slice_data</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">NN</span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#000">l</span><span style="color:#000;font-weight:bold">];</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#000">cache</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">l</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">label_fast</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f_val</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">extern</span> <span style="color:#4e9a06">&#34;C&#34;</span> <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">integer_labeling_3d_vec</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">grid_t</span> <span style="color:#000">GridDesc</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">ptr</span><span style="color:#000;font-weight:bold">)(</span><span style="color:#204a87;font-weight:bold">int</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">double</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">double</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000;font-weight:bold">),</span> 
</span></span><span style="display:flex;"><span>                                   <span style="color:#204a87;font-weight:bold">double</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">result</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">size</span><span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">vector</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">double</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">z</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">N</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">GridDesc</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Nxy</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Nz</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">GridDesc</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Nz</span><span style="color:#000;font-weight:bold">;</span>   
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">NN</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">N</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">N</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">NN_sub</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">N</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">N</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">unsigned</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#000">cnt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">iter_cnt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">grid_size</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Nz</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">char</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">cache_prev</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#204a87;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">NN</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">cache_next</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#204a87;font-weight:bold">char</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">NN</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">tmp</span><span style="color:#000;font-weight:bold">;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">double</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">slice_data_ptr</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#204a87;font-weight:bold">double</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">NN</span><span style="color:#000;font-weight:bold">];</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000">grid_size</span> <span style="color:#ce5c00;font-weight:bold">*=</span> <span style="color:#000">NN_sub</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000">x</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">resize</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">N</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">y</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">resize</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">N</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">z</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">resize</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Nz</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">N</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">x</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">GridDesc</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">x_min</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">GridDesc</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">x_max</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">GridDesc</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">x_min</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">N</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">y</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">GridDesc</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">y_min</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">GridDesc</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">y_max</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">GridDesc</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">y_min</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">N</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">Nz</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">z</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">GridDesc</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">z_min</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">GridDesc</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">z_max</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">GridDesc</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">z_min</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Nz</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#000">label_fast_vec</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f_wrapped_vec</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">N</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">z</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">ptr</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">slice_data_ptr</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">cache_prev</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">N</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>       
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">k</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">k</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">Nz</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000">k</span><span style="color:#000;font-weight:bold">){</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#000">label_fast_vec</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f_wrapped_vec</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">N</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">z</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">k</span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">ptr</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">slice_data_ptr</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">cache_next</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">N</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>               
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">l</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">l</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">NN</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">((</span><span style="color:#000">l</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#000">N</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#000">N</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">l</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#000">N</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#000">N</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">char</span> <span style="color:#000">label_flags</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">cache_prev</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">l</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">cache_prev</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">l</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">N</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">cache_next</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">l</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">cache_next</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">l</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">N</span><span style="color:#000;font-weight:bold">]);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000">l</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">label_flags</span> <span style="color:#ce5c00;font-weight:bold">|=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">cache_prev</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">l</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">cache_prev</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">l</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">N</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">cache_next</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">l</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">cache_next</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">l</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">N</span><span style="color:#000;font-weight:bold">]);</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>                <span style="color:#000">iter_cnt</span><span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">iter_cnt</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#0000cf;font-weight:bold">100000</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000">cout</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#000">iter_cnt</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#4e9a06">&#34; cubes checked from &#34;</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#000">grid_size</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#000">endl</span><span style="color:#000;font-weight:bold">;</span>                
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">COMPLETELY_LABELED</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">label_flags</span><span style="color:#000;font-weight:bold">)){</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000">result</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">cnt</span>    <span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">[(</span><span style="color:#000">l</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#000">N</span><span style="color:#000;font-weight:bold">];</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000">result</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">cnt</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">y</span><span style="color:#000;font-weight:bold">[(</span><span style="color:#000">l</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#000">N</span><span style="color:#000;font-weight:bold">];</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000">result</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">cnt</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">z</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">k</span><span style="color:#000;font-weight:bold">];</span>
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000">cnt</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span><span style="color:#204a87;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>                 <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000">l</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                 
</span></span><span style="display:flex;"><span>        <span style="color:#000">tmp</span>        <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cache_prev</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">cache_prev</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cache_next</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">cache_next</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">tmp</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">size</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cnt</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000">cout</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#000">cnt</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#4e9a06">&#34;  completely labeled cubes found, &#34;</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#000">grid_size</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#4e9a06">&#34; checked!&#34;</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#000">endl</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">delete</span><span style="color:#000;font-weight:bold">[]</span> <span style="color:#000">cache_prev</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">delete</span><span style="color:#000;font-weight:bold">[]</span> <span style="color:#000">cache_next</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">delete</span><span style="color:#000;font-weight:bold">[]</span> <span style="color:#000">slice_data_ptr</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>    
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>Notice that instead of simplicial space subdivision we have cubic grid.
Here&rsquo;s a little trick: let&rsquo;s call cube <em>completely labeled</em> if set of its vertices contains every possible labeling.</p>
<p><img src="/images/labeling.svg" alt="Integer labeling"></p>
<p>It&rsquo;s easy to see that completely labeled cube contains completely labeled simplex.
If we find such cube we can return necessary simplex, compute line segment where or
&hellip; just return corner coordinates which were enough for my purposes back then.
Because for small enough grids completely labeled cubes also can be used as rough, &ldquo;voxel&rdquo; approximation to zero set.</p>
<h2 id="details">Details</h2>
<p>Labeling data of cube layer stored in <em>cache_prev</em>, <em>cache_next</em> variables.
On every iteration we load two consecutive function data slices.
Cube labeling set is encoded by bits in  <em>label_flags</em> variable.</p>
<p>Basically, here we sum up some integer values for every cube of our grid in some speed-optimized manner.</p>
<pre tabindex="0"><code>   char label_flags = (cache_prev[l] | cache_prev[l + N] | cache_next[l] | cache_next[l + N]);
   ++l;
   label_flags |= (cache_prev[l] | cache_prev[l + N] | cache_next[l] | cache_next[l + N]);  
   if(COMPLETELY_LABELED(label_flags)){
      /* cube is found */
   }
</code></pre><p>Array <em>int map[] = {1, 1, 2, 4}</em> is a <em>map</em> between function sign combinations and bit flag values
{11 → 100, 10 → 010, 01 → 001, 00 → 001}. Macros <em>COMPLETELY_LABELED(&hellip;)</em> is defined simply as three 1&rsquo;s binary number</p>
<pre tabindex="0"><code>#define COMPLETELY_LABELED(x) ((x) == 0x7)
</code></pre><p>and that&rsquo;s it.</p>
<p>Note, that computations for each data slice (and actually for single grid cell) are independent.
Such code can be easily parallelized with standard frameworks like OMP or even ported on GPU.</p>
<h2 id="instead-of-conclusion">Instead of conclusion</h2>
<p>Now we have extended picture of algorithms for zero set computation.
Moreover, one can view marching algorithms as simplified versions of general simplex labeling.</p>
<table>
  <thead>
      <tr>
          <th>Signature</th>
          <th>Method</th>
          <th>Manifold type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>R<sup>2</sup> →  R</td>
          <td>Marching squares</td>
          <td>Curve</td>
      </tr>
      <tr>
          <td>R<sup>3</sup> → R</td>
          <td>Marching cubes</td>
          <td>Surface</td>
      </tr>
      <tr>
          <td>R<sup>n+d</sup> → R<sup>n</sup></td>
          <td><strong>Simplex labeling</strong></td>
          <td>d-Manifold</td>
      </tr>
  </tbody>
</table>
<p>Full version of the code you can find <a href="https://github.com/mihael-tunik/PLClib/blob/master/lib_src/PLC_lib_vec.cpp">here</a>.</p>
<p><a href="https://github.com/mihael-tunik/PLClib">Repository</a> contains corresponding python package (warning: this version is not well-tested) and where you can find examples and try it by your own.</p>
        </div>
    </article>
</div>
            <footer class="footer">    
    <p>⚡️ Blog powered by <a href="https://gohugo.io/" target="_blank">Hugo</a>. Using <a href="https://github.com/sergiobarriel/tophat-theme" target="_blank">Top Hat</a> theme.</p>
</footer>
        </div>
    </body>
</html>